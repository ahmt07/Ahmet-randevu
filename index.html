<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ahmet Tekeli Erkek Kuaf√∂r√º - Randevu Sistemi</title>
<style>
:root{--bg:#0b1016;--panel:#0e141b;--text:#e6eaf0;--muted:#98a6b6;--stroke:#1c2735;--gold:#f4c756}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:#0c1117;color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
.wrap{max-width:980px;margin:20px auto;padding:0 14px}
.panel{background:#0f151c;border:1px solid var(--stroke);border-radius:16px;padding:16px;margin-top:14px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:#0f151c;border:1px solid var(--stroke);border-radius:16px;padding:14px 16px}
.brand{display:flex;align-items:center;gap:12px}.title{font-weight:800}.subtitle{color:var(--muted);font-size:12px}
.row{display:flex;gap:12px;flex-wrap:wrap}.row>*{flex:1 1 220px}
input,select,button{width:100%;border-radius:12px;border:1px solid #2a384a;background:#0b1219;color:#e6eaf0;padding:10px 12px}
.action{border:1px solid rgba(244,199,86,.45);background:#19222c;color:#ffd977;font-weight:900;border-radius:12px;padding:12px 16px;cursor:pointer}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);padding:16px;z-index:40}
.modal.show{display:flex}.sheet{max-width:860px;width:100%;background:#0e141b;border:1px solid #1a2432;border-radius:16px;padding:14px}
.tabs{display:flex;gap:8px;margin:4px 0 10px}.tab{flex:1;text-align:center;border:1px solid #273346;border-radius:10px;padding:10px 12px;background:#0b1219;color:#d9e1ea;font-weight:800;cursor:pointer}.tab.active{border-color:rgba(244,199,86,.5);background:#151d25;color:#ffe59a}
.help{color:#95a3b5;font-size:12px;margin-top:8px}
.smallrow{display:flex;gap:6px;align-items:center;margin:6px 0}
.smallbtn{padding:8px 10px;border-radius:10px;border:1px solid #2a384a;background:#0b1219;color:#d9e1ea;cursor:pointer}
.smallbtn.gold{border-color:rgba(244,199,86,.5);color:#ffe59a}
.badge{display:inline-block;padding:2px 8px;border:1px solid #314259;border-radius:999px;margin-right:6px}
.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid #223043;padding:10px 8px;text-align:left;font-size:14px}
</style>
</head>
<body>
<div class="wrap">

  <div class="header">
    <div class="brand">
      <div class="title">Ahmet Tekeli Erkek Kuaf√∂r√º</div>
      <div class="subtitle">Randevu Sistemi</div>
    </div>
    <div class="row" style="flex:0 0 auto">
      <button class="action" id="openAdmin">üõ†Ô∏è Admin</button>
      <button class="action" id="openCustomer">üë§ M√º≈üteri</button>
    </div>
  </div>

  <form class="panel" onsubmit="return false">
    <legend>Randevu</legend>
    <div class="row"><div><label>Berber</label><select id="qBarber"></select></div><div><label>Hizmet</label><select id="qService"></select></div></div>
    <div class="row"><div><label>Tarih</label><input type="date" id="qDate"></div><div><label>Saat</label><select id="qTime"><option>Uygun saat i√ßin se√ßimleri yapƒ±n</option></select></div></div>
    <div class="row"><div><label>Ad Soyad</label><input id="qName"></div><div><label>Telefon</label><input id="qPhone" placeholder="05xxxxxxxxx"></div></div>
    <div class="row"><button type="button" class="action" id="qBook">Randevu Al</button><button type="button" class="action" id="qMine">Randevularƒ±m</button></div>
    <div class="help"><span class="badge">Bilgi</span> Aynƒ± berber aynƒ± saatte ikinci randevuya izin verilmez.</div>
  </form>

  <div class="modal" id="cModal"><div class="sheet">
    <h3>M√º≈üteri ‚Äì Giri≈ü / Kayƒ±t</h3>
    <div class="tabs"><div class="tab active" data-ctab="c-login">Giri≈ü</div><div class="tab" data-ctab="c-register">Kayƒ±t Ol</div><div class="tab" data-ctab="c-my">Randevularƒ±m</div><div style="margin-left:auto"><button class="tab" id="cClose">Kapat</button></div></div>
    <div id="c-login"><div class="row"><div><label>Telefon</label><input id="clPhone"></div><div><label>≈ûifre</label><input id="clPwd" type="password"></div></div><button class="action" id="btnLogin">Giri≈ü Yap</button></div>
    <div id="c-register" class="hidden"><div class="row"><div><label>Ad Soyad</label><input id="crName"></div><div><label>Telefon</label><input id="crPhone"></div></div><div class="row"><div><label>≈ûifre</label><input id="crPwd" type="password"></div></div><button class="action" id="btnRegister">Kayƒ±t Ol</button></div>
    <div id="c-my" class="hidden"><div id="myList"></div></div>
  </div></div>

  <div class="modal" id="aModal"><div class="sheet">
    <h3>Admin Paneli</h3>
    <div id="aGate"><div class="row"><div><input id="adUser" placeholder="admin"></div><div><input id="adPwd" type="password" placeholder="1234"></div></div><button class="action" id="btnAdminLogin">Giri≈ü Yap</button></div>
    <div id="aDash" class="hidden">
      <div class="tabs"><div class="tab active" data-atab="a-settings">Ayarlar</div><div class="tab" data-atab="a-appts">Randevular</div><div class="tab" data-atab="a-new">Yeni</div></div>

      <div id="a-settings">
        <div class="row"><div><label>Ba≈ülangƒ±√ß</label><input type="time" id="setStart"></div><div><label>Biti≈ü</label><input type="time" id="setEnd"></div><div><label>Slot (dk)</label><select id="setStep"><option>5</option><option>10</option><option>15</option><option>20</option><option>30</option></select></div></div>

        <h4>Berberler</h4>
        <div class="smallrow"><input id="newBarber" placeholder="Yeni berber"><button class="smallbtn gold" id="addBarber">Ekle</button></div>
        <div id="barberList" class="help"></div>

        <h4>Hizmetler</h4>
        <div class="smallrow"><input id="svcName" placeholder="Ad"><input id="svcDur" type="number" min="5" step="5" value="30" style="max-width:120px"><button class="smallbtn gold" id="addService">Ekle</button></div>
        <div id="serviceList" class="help"></div>

        <h4>Bildirimler</h4>
        <div class="smallrow"><input id="tgToken" placeholder="Telegram Bot Token"><input id="tgChat" placeholder="Chat ID (grup/√∂zel)"><button class="smallbtn gold" id="saveNotify">Kaydet</button></div>
        <div class="help">Botu kur: BotFather'dan token al, botu bir gruba ekle, gruba bir mesaj yaz ‚Üí chat_id‚Äôyi <code>getUpdates</code> ile bul ve buraya gir.</div>

        <div class="row"><button class="action" id="saveHours">√áalƒ±≈üma Saatlerini Kaydet</button></div>
      </div>

      <div id="a-appts" class="hidden">
        <div style="overflow:auto;margin-top:10px">
          <table class="table" id="aTable">
            <thead><tr><th>Tarih</th><th>Saat</th><th>Berber</th><th>Hizmet</th><th>S√ºre</th><th>M√º≈üteri</th><th>Tel</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div id="a-new" class="hidden">
        <div class="row"><div><input id="aname" placeholder="M√º≈üteri"></div><div><input id="aphone" placeholder="05..."></div></div>
        <div class="row"><div><select id="abarber"></select></div><div><select id="aservice"></select></div></div>
        <div class="row"><div><input type="date" id="adate"></div><div><select id="atime"><option>Uygun saat i√ßin</option></select></div></div>
        <button class="action" id="aCreate">Randevu Olu≈ütur</button>
      </div>
    </div>
  </div></div>

</div>

<script>
const LS={users:'atk_users',appts:'atk_appts',settings:'atk_settings',session:'atk_session',notify:'atk_notify'};
const defaults={workStart:'09:00',workEnd:'21:00',stepMin:10,barbers:['Ahmet','Ali','Mehmet'],services:[{id:'sac',name:'Sa√ß Kesimi',duration:30},{id:'sakal',name:'Sakal',duration:20},{id:'sacsakal',name:'Sa√ß + Sakal',duration:50}]};
function load(k,f){try{return JSON.parse(localStorage.getItem(k))??f}catch(e){return f}}function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
function uid(){return Math.random().toString(36).slice(2,10)}function $(id){return document.getElementById(id)}function clean(p){return (p||'').replace(/\D+/g,'')}
function t2m(t){const [h,m]=t.split(':').map(Number);return h*60+m}function gen(st,en,step){const a=[];for(let x=t2m(st);x<=t2m(en);x+=step)a.push((String(Math.floor(x/60)).padStart(2,'0')+':'+String(x%60).padStart(2,'0')));return a}
let users=load(LS.users,[]),appts=load(LS.appts,[]),settings=load(LS.settings,defaults),session=load(LS.session,null),notify=load(LS.notify,{token:'',chat:''});
const svcById=id=>(settings.services||[]).find(s=>s.id===id);

function conflict({barber,date,start,duration}){const s=t2m(start),e=s+duration;return appts.some(a=>a.barber===barber&&a.date===date&&Math.max(s,t2m(a.time))<Math.min(e,t2m(a.time)+a.duration))}
function freeTimes(barber,date,duration){if(!barber||!date||!duration)return[];return gen(settings.workStart,settings.workEnd,settings.stepMin).filter(t=>!conflict({barber,date,start:t,duration})&&t2m(t)+duration<=t2m(settings.workEnd))}

function fillSelects(){
  qBarber.innerHTML='<option value="">Farketmez</option>'+(settings.barbers||[]).map(b=>`<option>${b}</option>`).join('');
  qService.innerHTML='<option value="">Hizmet se√ßin</option>'+(settings.services||[]).map(s=>`<option value="${s.id}">${s.name} (${s.duration} dk)</option>`).join('');
  abarber.innerHTML=(settings.barbers||[]).map(b=>`<option>${b}</option>`).join('');
  aservice.innerHTML=(settings.services||[]).map(s=>`<option value="${s.id}">${s.name} (${s.duration} dk)</option>`).join('');
}

function updateTimes(ts,bs,ds,ss){
  const b=$(bs).value||settings.barbers[0],d=$(ds).value,svc=svcById($(ss).value),t=$(ts);
  if(!b||!d||!svc){t.innerHTML='<option>Uygun saat i√ßin se√ßimleri yapƒ±n</option>';return}
  const arr=freeTimes(b,d,svc.duration);
  t.innerHTML=arr.length?arr.map(x=>`<option>${x}</option>`).join(''):'<option>Uygun saat yok</option>';
}

['qBarber','qService','qDate'].forEach(id=>$(id).addEventListener('change',()=>updateTimes('qTime','qBarber','qDate','qService')));

async function notifyTelegram(appt){
  try{
    if(!notify.token||!notify.chat) return;
    const msg = `üóìÔ∏è Yeni Randevu%0A`+
      `Tarih: ${appt.date} ${appt.time}%0A`+
      `Berber: ${appt.barber}%0A`+
      `Hizmet: ${appt.serviceName} (${appt.duration} dk)%0A`+
      `M√º≈üteri: ${appt.name}%0A`+
      `Tel: ${appt.phone}`;
    await fetch(`https://api.telegram.org/bot${notify.token}/sendMessage?chat_id=${encodeURIComponent(notify.chat)}&text=${msg}`);
  }catch(e){ console.warn('Telegram bildirimi ba≈üarƒ±sƒ±z', e); }
}

function addRowToAdminTable(a){
  const body=document.querySelector('#aTable tbody');
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${a.date}</td><td>${a.time}</td><td>${a.barber}</td><td>${a.serviceName}</td><td>${a.duration} dk</td><td>${a.name||'-'}</td><td>${a.phone||'-'}</td>`;
  body.append(tr);
}

function renderAdminTable(){
  const body=document.querySelector('#aTable tbody'); body.innerHTML='';
  [...appts].sort((x,y)=>x.date.localeCompare(y.date)||x.time.localeCompare(y.time)).forEach(addRowToAdminTable);
}

function createAppt({userId,name,phone,barber,serviceId,date,time}){
  const svc=svcById(serviceId); if(!svc) return alert('Hizmet se√ßin.');
  if(!barber||!date||!time||!name||!phone) return alert('T√ºm alanlar zorunludur.');
  if(conflict({barber,date,start:time,duration:svc.duration})) return alert('Bu saat dolu.');
  const appt={id:uid(),userId:userId||null,name,phone:clean(phone),barber,serviceId,serviceName:svc.name,duration:svc.duration,date,time};
  appts.push(appt); save(LS.appts,appts);
  notifyTelegram(appt);
  alert('Randevu olu≈üturuldu.');
  renderAdminTable(); renderMine();
}

qBook.onclick=()=>{
  const barber=qBarber.value||settings.barbers[0],serviceId=qService.value,date=qDate.value,time=qTime.value,name=qName.value.trim(),phone=qPhone.value.trim();
  const u=users.find(x=>clean(x.phone)===clean(phone));
  createAppt({userId:u?u.id:null,name,phone,barber,serviceId,date,time});
};

qMine.onclick=()=>{cModal.classList.add('show'); setCTab('c-my'); renderMine()};

/* Customer modal */
function setCTab(x){['c-login','c-register','c-my'].forEach(id=>$(id).classList.toggle('hidden',id!==x));document.querySelectorAll('#cModal .tab').forEach(t=>t.classList.toggle('active',t.dataset.ctab===x))}
openCustomer.onclick=()=>cModal.classList.add('show'); cClose.onclick=()=>cModal.classList.remove('show');
document.querySelectorAll('#cModal .tab').forEach(t=>t.addEventListener('click',()=>setCTab(t.dataset.ctab)));
btnRegister.onclick=()=>{const name=crName.value.trim(),phone=clean(crPhone.value),pwd=crPwd.value;if(!name||!phone||!pwd)return alert('Zorunlu.');if(users.some(u=>u.phone===phone))return alert('Kayƒ±tlƒ±.');const u={id:uid(),name,phone,pwd};users.push(u);save(LS.users,users);alert('Kayƒ±t OK')};
btnLogin.onclick=()=>{const phone=clean(clPhone.value),pwd=clPwd.value;const u=users.find(u=>u.phone===phone&&u.pwd===pwd);if(!u)return alert('Hatalƒ±.');session={id:u.id};save(LS.session,session);alert('Giri≈ü OK')};

function renderMine(){
  const w=myList; w.innerHTML='';
  const u=session? users.find(x=>x.id===session.id) : null;
  if(!u){ w.innerHTML='<div class="help">Giri≈ü yapƒ±n ya da kayƒ±t olun.</div>'; return; }
  const list=appts.filter(a=>a.userId===u.id).sort((a,b)=>a.date.localeCompare(b.date)||a.time.localeCompare(b.time));
  if(!list.length){ w.innerHTML='<div class="help">Hen√ºz randevunuz yok.</div>'; return; }
  list.forEach(a=>{
    const row=document.createElement('div'); row.className='row'; row.style.margin='6px 0';
    row.innerHTML=`<div><span class="badge">${a.date} ‚Ä¢ ${a.time}</span> <b>${a.serviceName}</b> <span class="help">(${a.duration} dk)</span> ‚Äî <span class="help">${a.barber}</span></div>`;
    const R=document.createElement('div'); R.style.display='flex'; R.style.gap='8px';
    const d=document.createElement('button'); d.className='action'; d.textContent='ƒ∞ptal';
    d.onclick=()=>{ if(confirm('ƒ∞ptal edilsin mi?')){ appts=appts.filter(x=>x.id!==a.id); save(LS.appts,appts); renderMine(); renderAdminTable(); } };
    R.append(d); row.append(R); w.append(row);
  });
}

/* Admin modal */
openAdmin.onclick=()=>{ aModal.classList.add('show'); }
btnAdminLogin.onclick=()=>{
  if(adUser.value.trim()==='admin' && adPwd.value==='1234'){
    aGate.classList.add('hidden'); aDash.classList.remove('hidden');
    loadSettings(); fillSelects(); renderAdminTable();
  } else alert('Hatalƒ± giri≈ü.');
};
document.querySelectorAll('#aModal .tab').forEach(t=>t.addEventListener('click',()=>{
  ['a-settings','a-appts','a-new'].forEach(id=>$(id).classList.toggle('hidden',id!==t.dataset.atab));
  document.querySelectorAll('#aModal .tab').forEach(x=>x.classList.toggle('active',x.dataset.atab===t.dataset.atab));
}));

['abarber','aservice','adate'].forEach(id=>$(id).addEventListener('change',()=>updateTimes('atime','abarber','adate','aservice')));
aCreate.onclick=()=>{createAppt({name:aname.value.trim(),phone:aphone.value.trim(),barber:abarber.value,serviceId:aservice.value,date:adate.value,time:atime.value});renderAdminTable()};

/* Settings */
function loadSettings(){
  setStart.value=settings.workStart; setEnd.value=settings.workEnd; setStep.value=String(settings.stepMin);
  tgToken.value=notify.token||''; tgChat.value=notify.chat||'';
  updateLists(); fillSelects();
}
saveHours.onclick=()=>{
  const st=setStart.value, en=setEnd.value, step=parseInt(setStep.value||'10');
  if(!st||!en||t2m(st)>=t2m(en)) return alert('Saat aralƒ±ƒüƒ± yanlƒ±≈ü');
  settings.workStart=st; settings.workEnd=en; settings.stepMin=step; save(LS.settings,settings); alert('Kaydedildi');
};
saveNotify.onclick=()=>{
  notify={token:tgToken.value.trim(), chat:tgChat.value.trim()};
  save(LS.notify, notify);
  alert('Telegram bilgileri kaydedildi.');
};

function updateLists(){
  // Barbers
  barberList.innerHTML=(settings.barbers||[]).map((b,i)=>`
    <div class='smallrow'>
      <input value='${b}' id='bar_in_${i}'/>
      <button class='smallbtn gold' onclick='editBarber(${i})'>Kaydet</button>
      <button class='smallbtn' onclick='removeBarber(${i})'>Sil</button>
    </div>`).join('');
  // Services
  serviceList.innerHTML=(settings.services||[]).map((s,i)=>`
    <div class='smallrow'>
      <input value='${s.name}' id='svc_name_${i}'/>
      <input type='number' min='5' step='5' value='${s.duration}' id='svc_dur_${i}' style='max-width:110px'/>
      <button class='smallbtn gold' onclick='editService(${i})'>Kaydet</button>
      <button class='smallbtn' onclick='removeService(${i})'>Sil</button>
    </div>`).join('');
}
window.editBarber=(i)=>{const val=document.getElementById('bar_in_'+i).value.trim();if(!val)return;settings.barbers[i]=val;save(LS.settings,settings);updateLists();fillSelects()}
window.removeBarber=(i)=>{settings.barbers.splice(i,1);save(LS.settings,settings);updateLists();fillSelects()}
window.editService=(i)=>{const n=document.getElementById('svc_name_'+i).value.trim();const d=parseInt(document.getElementById('svc_dur_'+i).value||'0');if(!n||!d)return;settings.services[i].name=n;settings.services[i].duration=d;save(LS.settings,settings);updateLists();fillSelects()}
window.removeService=(i)=>{settings.services.splice(i,1);save(LS.settings,settings);updateLists();fillSelects()}

/* INIT */
(function(){
  if(!settings||!settings.barbers||!settings.services){settings=defaults;save(LS.settings,settings)}
  fillSelects();
})();
</script>
</body>
</html>
